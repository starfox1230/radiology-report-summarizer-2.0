<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Radiology Report Summarizer</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background-color: #f4f4f9;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }

        .container {
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            padding: 20px;
            max-width: 800px;
            width: 100%;
            box-sizing: border-box;
            overflow-y: auto;
            max-height: 90vh;
        }

        h1, h2 {
            text-align: center;
            color: #333;
        }

        label {
            font-size: 18px;
            margin-bottom: 8px;
            display: block;
            color: #555;
        }

        textarea {
            width: 100%;
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #ddd;
            font-size: 16px;
            min-height: 100px;
            box-sizing: border-box;
        }

        button {
            display: block;
            width: 100%;
            padding: 10px;
            border: none;
            border-radius: 5px;
            background-color: #007bff;
            color: white;
            font-size: 18px;
            cursor: pointer;
            margin-top: 15px;
        }

        button:hover {
            background-color: #0056b3;
        }

        .output-container {
            margin-top: 20px;
        }

        .case-container {
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 15px;
            margin-bottom: 20px;
            background-color: #f9f9f9;
        }

        .case-header {
            font-weight: bold;
            font-size: 1.2em;
            margin-bottom: 5px;
        }

        .score {
            font-weight: bold;
            color: #007bff;
        }

        ul {
            margin: 0;
            padding-left: 20px;
        }

        .footer {
            text-align: center;
            margin-top: 20px;
            color: #999;
            font-size: 14px;
        }
    </style>
</head>
<body>

    <div class="container">
        <h1>Radiology Report Summarizer</h1>

        <!-- Add a new field for customizing the OpenAI API prompt -->
        <form method="POST" action="/process">
            <label for="custom_prompt">Customize your OpenAI API prompt:</label>
            <textarea id="custom_prompt" name="custom_prompt">
Succinctly organize the changes made by the attending to the resident's radiology reports into: 1) missed major findings (life threatening or treatment altering), 2) missed minor findings, and 3) clarified descriptions of findings. Assume the attending's version was correct, and anything not included by the attending but was included by the resident should have been left out by the resident. Keep your answers brief and to the point. The reports are:

Please output your response as structured JSON, with the following keys:
- "case_number": The case number sent in the request.
- "major_findings": A list of any major findings missed by the resident (life-threatening or treatment-altering).
- "minor_findings": A list of minor findings missed by the resident.
- "clarifications": A list of any clarifications the attending made to improve understanding.
- "score": The calculated score, where each major finding is worth 3 points and each minor finding is worth 1 point.

Respond in this JSON format, with no other additional text or pleasantries:
{
  "case_number": <case_number>,
  "major_findings": [<major_findings>],
  "minor_findings": [<minor_findings>],
  "clarifications": [<clarifications>],
  "score": <score>
}
            </textarea>

            <label for="case_text">Paste your radiology reports here:</label>
            <textarea id="case_text" name="case_text">{{ case_text }}</textarea>
            <button type="submit">Get Summaries</button>
        </form>

        <div class="output-container">
            <h2>Summaries</h2>

            {% if summary %}
                {% for case in summary %}
                    <div class="case-container">
                        <div class="case-header">Case {{ case.case_number }}</div>

                        <p><span class="score">Score:</span> {{ case.score }}</p>

                        {% if case.major_findings %}
                            <p><strong>Major Findings:</strong></p>
                            <ul>
                                {% for finding in case.major_findings %}
                                    <li>{{ finding }}</li>
                                {% endfor %}
                            </ul>
                        {% else %}
                            <p><em>No major findings.</em></p>
                        {% endif %}

                        {% if case.minor_findings %}
                            <p><strong>Minor Findings:</strong></p>
                            <ul>
                                {% for finding in case.minor_findings %}
                                    <li>{{ finding }}</li>
                                {% endfor %}
                            </ul>
                        {% else %}
                            <p><em>No minor findings.</em></p>
                        {% endif %}

                        {% if case.clarifications %}
                            <p><strong>Clarifications:</strong></p>
                            <ul>
                                {% for clarification in case.clarifications %}
                                    <li>{{ clarification }}</li>
                                {% endfor %}
                            </ul>
                        {% else %}
                            <p><em>No clarifications.</em></p>
                        {% endif %}
                    </div>
                {% endfor %}
            {% else %}
                <p>No cases available.</p>
            {% endif %}
        </div>

        <div class="footer">
            <p>&copy; 2024 Radiology Report Summarizer</p>
        </div>
    </div>

</body>
</html>
